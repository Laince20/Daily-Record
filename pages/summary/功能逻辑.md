# Summary页面功能逻辑梳理

## 一、页面核心功能
### 1. 日期选择与会话展示
- 默认显示当天日期
- 提供日历组件选择历史日期
- 展示所选日期的会话内容
- 空状态处理机制

### 2. AI自动总结展示
- 5点前：显示"今日总结将在5:00自动生成"提示
- 5点后：展示前一天的AI总结
- 总结生成状态实时反馈

## 二、数据结构设计
### 1. 会话数据
- 按日期存储的用户对话记录
- 包含最新更新时间字段

### 2. 总结数据
- 每天24点自动生成的AI总结
- 包含用户ID、日期、总结内容等字段

## 三、页面交互流程
### 1. 日期选择流程
1. 进入页面默认显示当天
2. 用户选择历史日期
3. 系统查询并展示对应会话
4. 处理无数据情况

### 2. 总结展示流程
1. 检查当前时间
2. 判断总结生成状态
3. 展示对应内容或提示

## 四、AI总结生成机制
### 1. 数据收集
- 获取当日所有会话记录
- 按时间顺序整理对话内容
- 保留完整对话上下文

### 2. 数据处理
- 合并多段对话
- 添加会话分隔标记
- 保持原始对话完整性

### 3. 输出格式
```text
==示例回复==
事件名称：[具体事件概括名称 1]
要点提炼：
[具体要点内容 1]

事件名称：[具体事件概括名称 2]
要点提炼：
[具体要点内容 2]

…… （可根据实际事件数量增加）

认知迭代：
[具体认知迭代内容]

建议：
[基于对话内容给出的建议]

==示例结束==
```

## 五、云函数实现
### 1. 基础配置
- 函数名：`generateDailySummary`
- 触发时间：每天5:00
- 运行环境：Node.js

### 2. API配置
```javascript
const COZE_API = {
  BOT_ID: '7501259148005507111',
  API_KEY: 'pat_VPCHYnPhCMvIgqmFgpcC5lbtyp8lnEV5xkndHwc1xG4oJgT6UG6nNGuDHKZGZKxu',
  BASE_URL: 'https://api.coze.cn'
}
```

### 3. 调用流程
1. 获取昨日日期
2. 查询会话记录
3. 格式化数据
4. 调用API生成总结
5. 保存到数据库

### 4. API调用格式
```javascript
// 创建会话
POST /v1/conversation/create
{
  bot_id: COZE_API.BOT_ID,
  messages: [{
    role: 'user',
    content: formattedData,
    content_type: 'text'
  }]
}

// 获取总结
POST /open_api/v2/chat
{
  bot_id: COZE_API.BOT_ID,
  user: "system",
  query: "请帮我总结以下对话内容：" + formattedData,
  stream: false
}
```

## 六、数据存储设计

### 2. 云数据库
- conversations集合：存储对话内容
- summaries集合：存储AI总结

## 七、错误处理机制
### 1. 会话获取
- 失败时记录日志
- 返回空数组

### 2. API调用
- 记录详细错误信息
- 返回null

### 3. 数据保存
- 记录错误日志
- 返回false

## 八、注意事项
1. API密钥安全存储
2. 控制API调用频率
3. 确保数据格式一致
4. 完善错误处理
5. 保持详细日志记录 