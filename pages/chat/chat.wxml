<view class="page-container">
  <view class="container">
    <!-- å¤´éƒ¨å¯¼èˆªæ  -->
    <view class="nav-bar">
      <view class="sidebar-btn" bindtap="showHistoryList">
        <text class="sidebar-icon">â‰¡</text>
      </view>
      <view class="nav-right">
        <!-- å³ä¾§å¯ä»¥æ”¾ç½®å…¶ä»–æŒ‰é’® -->
      </view>
    </view>
    
    <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
    <scroll-view class="chat-container" scroll-y="true" scroll-into-view="{{scrollToView}}" scroll-with-animation="{{true}}" enhanced="true" show-scrollbar="false">
      <!-- å±•ç¤ºæ¶ˆæ¯è®°å½• -->
      <block wx:for="{{messages}}" wx:key="index">
        <!-- AIæ¶ˆæ¯ -->
        <view wx:if="{{item.role === 'ai'}}" class="message-row ai-row" id="msg-{{index}}">
          <view class="avatar avatar-placeholder"></view>
          <view class="message-bubble ai-message">{{item.content}}</view>
        </view>
        
        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <view wx:else class="message-row user-row" id="msg-{{index}}">
          <view class="message-bubble user-message">{{item.content}}</view>
          <view class="avatar avatar-placeholder"></view>
        </view>
      </block>
      
      <!-- å ä½å…ƒç´ ï¼Œä¿è¯æ»šåŠ¨åˆ°åº•éƒ¨ -->
      <view id="message-bottom" style="height: 30rpx;"></view>
    </scroll-view>
  </view>
  
  <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸå›ºå®šåœ¨åº•éƒ¨ -->
  <view class="input-area" style="position: fixed; left: 0rpx; top: 1314rpx">
    <!-- æ–‡å­—è¾“å…¥æ¨¡å¼ -->
    <view class="message-input-container" wx:if="{{!isVoiceMode}}">
      <view class="voice-mode-icon" bindtap="switchMode">
        <text>ğŸ¤</text>
      </view>
      <input class="message-input" 
             placeholder="è¾“å…¥é—®é¢˜ï¼Œè·å– AI å›ç­”" 
             value="{{inputValue}}" 
             bindinput="inputChange" 
             confirm-type="send" 
             bindconfirm="sendMessage" 
             focus="{{textFocus}}"
             adjust-position="false"
             cursor-spacing="20"/>
      <view class="send-icon" bindtap="sendMessage">
        <text class="send-arrow">â¤</text>
      </view>
    </view>
    
    <!-- è¯­éŸ³è¾“å…¥æ¨¡å¼ -->
    <view class="voice-input-container" wx:else>
      <view class="press-talk-text {{isRecording ? 'recording' : ''}}" 
            bindtouchstart="startRecording" 
            bindtouchend="stopRecording"
            bindtouchmove="moveRecording"
            bindtouchcancel="cancelRecording">
        {{isRecording ? 'æ¾å¼€å‘é€' : 'æŒ‰ä½è¯´è¯'}}
      </view>
      <view class="keyboard-icon" bindtap="switchMode">
        <text>âŒ¨ï¸</text>
      </view>
    </view>
  </view>
  
  <!-- å†å²å¯¹è¯åˆ—è¡¨ä¾§è¾¹æ  -->
  <view class="history-sidebar {{isHistorySidebarOpen ? 'open' : ''}}">
    <view class="sidebar-header">
      <text>å†å²å¯¹è¯</text>
      <view class="close-btn" bindtap="hideHistoryList">Ã—</view>
    </view>
    
    <!-- æ–°å»ºå¯¹è¯æŒ‰é’® -->
    <view class="create-conversation" bindtap="createNewConversation">
      <text class="add-icon">+</text>
      <text>æ–°å»ºå¯¹è¯</text>
    </view>
    
    <view class="history-list">
      <block wx:for="{{conversationList}}" wx:key="id">
        <view class="history-item" bindtap="selectConversation" data-id="{{item.id}}">
          <view class="history-content">
            <text class="history-title">{{item.title || 'å¯¹è¯ ' + (index + 1)}}</text>
            <text class="history-date">{{item.date}}</text>
          </view>
          <view class="delete-btn" catchtap="deleteConversation" data-id="{{item.id}}">
            <text>Ã—</text>
          </view>
        </view>
      </block>
      <view wx:if="{{conversationList.length === 0}}" class="empty-history">
        <text>æš‚æ— å†å²å¯¹è¯</text>
      </view>
    </view>
  </view>
  
  <!-- å½•éŸ³çŠ¶æ€æç¤º -->
  <view class="status-indicator" wx:if="{{statusText}}">
    <text>{{statusText}}</text>
  </view>
  
  <!-- é®ç½©å±‚ -->
  <view class="mask" wx:if="{{isHistorySidebarOpen}}" bindtap="hideHistoryList"></view>
</view> 